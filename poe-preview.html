<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEELEE月入过万不是梦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#00D4FF',
                        accent: '#FF6B6B',
                        success: '#00E676',
                        warning: '#FFB74D',
                        dark: {
                            bg: '#0a0a0a',
                            card: '#1a1a1a',
                            border: '#2a2a2a'
                        }
                    },
                    backgroundImage: {
                        'gradient-tech': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                        'gradient-success': 'linear-gradient(135deg, #00E676 0%, #00BCD4 100%)',
                        'gradient-warning': 'linear-gradient(135deg, #FFB74D 0%, #FF8A65 100%)',
                        'gradient-danger': 'linear-gradient(135deg, #FF6B6B 0%, #EE5A52 100%)'
                    }
                }
            }
        }
    </script>
    <style>
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .tech-border {
            border-image: linear-gradient(45deg, #5D5CDE, #00D4FF, #FF6B6B) 1;
        }
        .hover-scale {
            transition: transform 0.3s ease;
        }
        .hover-scale:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-dark-bg dark:via-gray-900 dark:to-black min-h-screen transition-all duration-300">

<!-- 登录页面 -->
<div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
    <div class="glass-effect rounded-2xl p-8 w-full max-w-md animate-float">
        <div class="text-center mb-8">
            <div class="bg-gradient-tech rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center">
                <i class="fas fa-cube text-white text-2xl"></i>
            </div>
            <h1 class="text-2xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                LEELEE月入过万不是梦
            </h1>
            <p class="text-gray-600 dark:text-gray-400 mt-2">请登录您的账户</p>
        </div>
        
        <form id="loginForm" class="space-y-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">用户名</label>
                <input type="text" id="username" class="w-full px-4 py-3 text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-primary dark:bg-gray-800 dark:text-white transition-colors" placeholder="请输入用户名">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">密码</label>
                <input type="password" id="password" class="w-full px-4 py-3 text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-primary dark:bg-gray-800 dark:text-white transition-colors" placeholder="请输入密码">
            </div>
            <div class="flex items-center">
                <input type="checkbox" id="rememberMe" class="w-4 h-4 text-primary border-gray-300 rounded">
                <label for="rememberMe" class="ml-2 text-sm text-gray-700 dark:text-gray-300">记住登录状态</label>
            </div>
            <button type="submit" class="w-full bg-gradient-tech text-white py-3 rounded-xl hover:shadow-lg transform hover:scale-105 transition-all duration-300 font-medium">
                登录
            </button>
        </form>
        

    </div>
</div>

<!-- 主应用页面 -->
<div id="mainApp" class="hidden">
    <!-- 顶部导航 -->
    <nav class="glass-effect sticky top-0 z-50 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="bg-gradient-tech rounded-lg w-10 h-10 flex items-center justify-center">
                    <i class="fas fa-cube text-white"></i>
                </div>
                <h1 class="text-xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                    LEELEE月入过万不是梦
                </h1>
            </div>
            <div class="flex items-center space-x-4">
                <span id="userInfo" class="text-sm text-gray-600 dark:text-gray-400"></span>
                <button id="userManagementBtn" class="hidden bg-gradient-success px-4 py-2 rounded-lg text-white hover:shadow-lg transition-all duration-300">
                    <i class="fas fa-users mr-2"></i>用户管理
                </button>
                <button id="logoutBtn" class="bg-gradient-danger px-4 py-2 rounded-lg text-white hover:shadow-lg transition-all duration-300">
                    <i class="fas fa-sign-out-alt mr-2"></i>登出
                </button>
            </div>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <div class="container mx-auto px-6 py-8">
        <!-- 统计卡片 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl p-6 text-white hover-scale">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-blue-100">总商品数</p>
                        <p id="totalProducts" class="text-3xl font-bold">0</p>
                    </div>
                    <i class="fas fa-box text-4xl text-blue-200"></i>
                </div>
            </div>
            <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-2xl p-6 text-white hover-scale">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-green-100">已售出</p>
                        <p id="soldProducts" class="text-3xl font-bold">0</p>
                    </div>
                    <i class="fas fa-check-circle text-4xl text-green-200"></i>
                </div>
            </div>
            <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-2xl p-6 text-white hover-scale">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-orange-100">库存中</p>
                        <p id="inStockProducts" class="text-3xl font-bold">0</p>
                    </div>
                    <i class="fas fa-warehouse text-4xl text-orange-200"></i>
                </div>
            </div>
            <div class="bg-gradient-to-r from-cyan-500 to-cyan-600 rounded-2xl p-6 text-white hover-scale">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-cyan-100">售出价值</p>
                        <p id="soldValue" class="text-3xl font-bold">¥0</p>
                    </div>
                    <i class="fas fa-coins text-4xl text-cyan-200"></i>
                </div>
            </div>
            <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-2xl p-6 text-white hover-scale">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-purple-100">库存价值</p>
                        <p id="totalValue" class="text-3xl font-bold">¥0</p>
                    </div>
                    <i class="fas fa-dollar-sign text-4xl text-purple-200"></i>
                </div>
            </div>
        </div>

        <!-- 操作区域 -->
        <div class="glass-effect rounded-2xl p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                <div class="flex flex-col md:flex-row gap-4 items-center">
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="搜索商品..." class="pl-10 pr-4 py-3 text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-primary dark:bg-gray-800 dark:text-white w-full md:w-64">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <select id="categoryFilter" class="px-4 py-3 text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-primary dark:bg-gray-800 dark:text-white">
                        <option value="">所有分类</option>
                    </select>
                </div>
                <button id="addProductBtn" class="bg-gradient-tech px-6 py-3 rounded-xl text-white hover:shadow-lg transform hover:scale-105 transition-all duration-300 font-medium">
                    <i class="fas fa-plus mr-2"></i>添加商品
                </button>
            </div>
        </div>

        <!-- 商品列表 -->
        <div class="glass-effect rounded-2xl p-6">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">商品列表</h2>
            <div id="productList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- 商品卡片将在这里动态生成 -->
            </div>
        </div>
    </div>
</div>

<!-- 添加/编辑商品模态框 -->
<div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 w-full max-w-md max-h-screen overflow-y-auto">
        <h3 id="modalTitle" class="text-2xl font-bold text-gray-800 dark:text-white mb-6">添加商品</h3>
        <form id="productForm" class="space-y-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">商品名称</label>
                <input type="text" id="productName" class="w-full px-4 py-3 text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-primary dark:bg-gray-700 dark:text-white" required="">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">商品图片</label>
                <input type="file" id="productImage" accept="image/*" class="w-full px-4 py-3 text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-primary dark:bg-gray-700 dark:text-white">
                <div id="imagePreview" class="mt-4 hidden">
                    <img id="previewImg" class="w-full aspect-[3/4] object-cover rounded-xl">
                </div>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">推荐尺寸: 1536 × 2048 像素 (3:4 比例)</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">商品分类</label>
                <div class="flex gap-2">
                    <select id="productCategory" class="flex-1 px-4 py-3 text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-primary dark:bg-gray-700 dark:text-white">
                        <option value="">选择分类</option>
                    </select>
                    <button type="button" id="addCategoryBtn" class="bg-secondary px-4 py-3 rounded-xl text-white hover:shadow-lg transition-all duration-300">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">售价</label>
                    <input type="number" id="productPrice" step="0.01" class="w-full px-4 py-3 text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-primary dark:bg-gray-700 dark:text-white" required="">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">库存</label>
                    <input type="number" id="productStock" class="w-full px-4 py-3 text-base border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:border-primary dark:bg-gray-700 dark:text-white" required="">
                </div>
            </div>
            <div class="flex items-center">
                <input type="checkbox" id="productSold" class="w-4 h-4 text-primary border-gray-300 rounded">
                <label for="productSold" class="ml-2 text-sm text-gray-700 dark:text-gray-300">已售出</label>
            </div>
            <div class="flex gap-4">
                <button type="button" id="cancelBtn" class="flex-1 px-4 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all duration-300">取消</button>
                <button type="submit" class="flex-1 bg-gradient-tech text-white px-4 py-3 rounded-xl hover:shadow-lg transition-all duration-300">保存</button>
            </div>
        </form>
    </div>
</div>

<!-- 用户管理模态框 -->
<div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 w-full max-w-2xl max-h-screen overflow-y-auto">
        <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">用户管理</h3>
        
        <!-- 添加用户 -->
        <div class="mb-8 p-6 bg-gray-50 dark:bg-gray-700 rounded-xl">
            <h4 class="text-lg font-semibold mb-4">添加新用户</h4>
            <form id="addUserForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="text" id="newUsername" placeholder="用户名" class="px-4 py-2 text-base border rounded-lg dark:bg-gray-600 dark:text-white" required="">
                <input type="password" id="newPassword" placeholder="密码" class="px-4 py-2 text-base border rounded-lg dark:bg-gray-600 dark:text-white" required="">
                <div class="flex gap-2">
                    <select id="newUserRole" class="flex-1 px-4 py-2 text-base border rounded-lg dark:bg-gray-600 dark:text-white">
                        <option value="staff">员工</option>
                        <option value="admin">管理员</option>
                    </select>
                    <button type="submit" class="bg-gradient-success px-4 py-2 rounded-lg text-white hover:shadow-lg transition-all duration-300">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </form>
        </div>

        <!-- 用户列表 -->
        <div class="space-y-4">
            <h4 class="text-lg font-semibold">现有用户</h4>
            <div id="userList" class="space-y-3">
                <!-- 用户列表将在这里生成 -->
            </div>
        </div>

        <div class="flex justify-end mt-6">
            <button id="closeUserModal" class="px-6 py-3 bg-gray-500 text-white rounded-xl hover:bg-gray-600 transition-all duration-300">关闭</button>
        </div>
    </div>
</div>

<!-- 自定义确认对话框 -->
<div id="confirmDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl max-w-sm w-full mx-4">
        <p id="confirmMessage" class="text-gray-700 dark:text-gray-300 mb-6"></p>
        <div class="flex justify-end space-x-3">
            <button id="confirmCancel" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-300">取消</button>
            <button id="confirmOk" class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded-lg transition-all duration-300">确认</button>
        </div>
    </div>
</div>

<script>
// 全局变量
let currentUser = null;
let products = [];
let users = [
    { id: 1, username: 'admin', password: 'admin123', role: 'admin', active: true },
    { id: 2, username: 'staff', password: 'staff123', role: 'staff', active: true }
];
let categories = ['电子产品', '服装', '家居用品', '食品饮料', '图书文具'];
let editingProductId = null;

// 深色模式检测
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.classList.add('dark');
}
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
    if (event.matches) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
});

// 自定义确认对话框
function showConfirmDialog(message, onConfirm) {
    const dialog = document.getElementById('confirmDialog');
    const messageEl = document.getElementById('confirmMessage');
    const cancelBtn = document.getElementById('confirmCancel');
    const okBtn = document.getElementById('confirmOk');
    
    messageEl.textContent = message;
    dialog.classList.remove('hidden');
    
    const handleCancel = () => {
        dialog.classList.add('hidden');
        cancelBtn.removeEventListener('click', handleCancel);
        okBtn.removeEventListener('click', handleOk);
    };
    
    const handleOk = () => {
        dialog.classList.add('hidden');
        onConfirm();
        cancelBtn.removeEventListener('click', handleCancel);
        okBtn.removeEventListener('click', handleOk);
    };
    
    cancelBtn.addEventListener('click', handleCancel);
    okBtn.addEventListener('click', handleOk);
}

// 初始化
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});

function initializeApp() {
    setupEventListeners();
    updateCategoryOptions();
    checkRememberedLogin();
}

function setupEventListeners() {
    // 登录表单
    document.getElementById('loginForm').addEventListener('submit', handleLogin);
    
    // 登出按钮
    document.getElementById('logoutBtn').addEventListener('click', handleLogout);
    
    // 添加商品按钮
    document.getElementById('addProductBtn').addEventListener('click', () => openProductModal());
    
    // 商品表单
    document.getElementById('productForm').addEventListener('submit', handleProductSubmit);
    document.getElementById('cancelBtn').addEventListener('click', closeProductModal);
    
    // 图片预览
    document.getElementById('productImage').addEventListener('change', handleImagePreview);
    
    // 添加分类按钮
    document.getElementById('addCategoryBtn').addEventListener('click', handleAddCategory);
    
    // 搜索和筛选
    document.getElementById('searchInput').addEventListener('input', filterProducts);
    document.getElementById('categoryFilter').addEventListener('change', filterProducts);
    
    // 用户管理
    document.getElementById('userManagementBtn').addEventListener('click', openUserModal);
    document.getElementById('closeUserModal').addEventListener('click', closeUserModal);
    document.getElementById('addUserForm').addEventListener('submit', handleAddUser);
}

function checkRememberedLogin() {
    // 由于无法使用localStorage，这里只是模拟检查
    // 在实际应用中，这里会检查localStorage中的登录状态
}

function handleLogin(e) {
    e.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const rememberMe = document.getElementById('rememberMe').checked;
    
    const user = users.find(u => u.username === username && u.password === password && u.active);
    
    if (user) {
        currentUser = user;
        showMainApp();
        updateUserInfo();
        loadProducts();
        
        if (rememberMe) {
            // 在实际应用中，这里会设置localStorage
            console.log('记住登录状态');
        }
    } else {
        showAlert('用户名或密码错误，或账户已被禁用');
    }
}

function handleLogout() {
    showConfirmDialog('确定要登出吗？', () => {
        currentUser = null;
        document.getElementById('loginPage').classList.remove('hidden');
        document.getElementById('mainApp').classList.add('hidden');
        document.getElementById('loginForm').reset();
    });
}

function showMainApp() {
    document.getElementById('loginPage').classList.add('hidden');
    document.getElementById('mainApp').classList.remove('hidden');
}

function updateUserInfo() {
    const userInfo = document.getElementById('userInfo');
    const userManagementBtn = document.getElementById('userManagementBtn');
    
    userInfo.textContent = `${currentUser.username} (${currentUser.role === 'admin' ? '管理员' : '员工'})`;
    
    if (currentUser.role === 'admin') {
        userManagementBtn.classList.remove('hidden');
    } else {
        userManagementBtn.classList.add('hidden');
    }
}

function loadProducts() {
    renderProducts();
    updateStatistics();
}

function renderProducts() {
    const productList = document.getElementById('productList');
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const categoryFilter = document.getElementById('categoryFilter').value;
    
    let filteredProducts = products.filter(product => {
        const matchesSearch = product.name.toLowerCase().includes(searchTerm);
        const matchesCategory = !categoryFilter || product.category === categoryFilter;
        return matchesSearch && matchesCategory;
    });
    
    if (filteredProducts.length === 0) {
        productList.innerHTML = `
            <div class="col-span-full text-center py-12">
                <i class="fas fa-box-open text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
                <p class="text-gray-500 dark:text-gray-400 text-lg">暂无商品</p>
            </div>
        `;
        return;
    }
    
    productList.innerHTML = filteredProducts.map(product => `
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
            <div class="relative">
                <img src="${product.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUzNiIgaGVpZ2h0PSIyMDQ4IiB2aWV3Qm94PSIwIDAgMTUzNiAyMDQ4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cmVjdCB3aWR0aD0iMTUzNiIgaGVpZ2h0PSIyMDQ4IiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik02ODAgNjgwSDg1NlY4NTZINDY4VjY4MFoiIGZpbGw9IiM5Q0EzQUYiLz4KPHN2Zz4K'}" 
                     alt="${product.name}" 
                     class="w-full aspect-[3/4] object-cover rounded-xl mb-4">
                ${product.sold ? '<div class="absolute top-2 right-2 bg-success text-white px-2 py-1 rounded-lg text-xs font-medium">已售出</div>' : ''}
                ${product.stock <= 5 && !product.sold ? '<div class="absolute top-2 right-2 bg-warning text-white px-2 py-1 rounded-lg text-xs font-medium">库存不足</div>' : ''}
            </div>
            
            <div class="space-y-3">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white">${product.name}</h3>
                <div class="flex items-center justify-between">
                    <span class="bg-primary/10 text-primary px-3 py-1 rounded-lg text-sm font-medium">${product.category}</span>
                    <span class="text-2xl font-bold text-gray-800 dark:text-white">¥${product.price}</span>
                </div>
                <div class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-400">
                    <span>库存: ${product.stock}</span>
                    <span>状态: ${product.sold ? '已售出' : '在售'}</span>
                </div>
                
                ${currentUser.role === 'admin' ? `
                <div class="flex gap-2 pt-4">
                    <button onclick="editProduct(${product.id})" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-2 rounded-xl hover:shadow-lg transition-all duration-300">
                        <i class="fas fa-edit mr-2"></i>编辑
                    </button>
                    <button onclick="deleteProduct(${product.id})" class="flex-1 bg-gradient-danger text-white py-2 rounded-xl hover:shadow-lg transition-all duration-300">
                        <i class="fas fa-trash mr-2"></i>删除
                    </button>
                </div>
                ` : ''}
            </div>
        </div>
    `).join('');
}

function updateStatistics() {
    const totalProducts = products.length;
    const soldProducts = products.filter(p => p.sold).length;
    const inStockProducts = totalProducts - soldProducts;
    const totalValue = products.reduce((sum, p) => sum + (p.price * p.stock), 0);
    const soldValue = products.filter(p => p.sold).reduce((sum, p) => sum + p.price, 0);
    
    document.getElementById('totalProducts').textContent = totalProducts;
    document.getElementById('soldProducts').textContent = soldProducts;
    document.getElementById('inStockProducts').textContent = inStockProducts;
    document.getElementById('soldValue').textContent = `¥${soldValue.toFixed(2)}`;
    document.getElementById('totalValue').textContent = `¥${totalValue.toFixed(2)}`;
}

function openProductModal(product = null) {
    const modal = document.getElementById('productModal');
    const modalTitle = document.getElementById('modalTitle');
    const form = document.getElementById('productForm');
    
    editingProductId = product ? product.id : null;
    modalTitle.textContent = product ? '编辑商品' : '添加商品';
    
    if (product) {
        document.getElementById('productName').value = product.name;
        document.getElementById('productCategory').value = product.category;
        document.getElementById('productPrice').value = product.price;
        document.getElementById('productStock').value = product.stock;
        document.getElementById('productSold').checked = product.sold;
        
        if (product.image) {
            document.getElementById('imagePreview').classList.remove('hidden');
            document.getElementById('previewImg').src = product.image;
        }
    } else {
        form.reset();
        document.getElementById('imagePreview').classList.add('hidden');
    }
    
    modal.classList.remove('hidden');
}

function closeProductModal() {
    document.getElementById('productModal').classList.add('hidden');
    editingProductId = null;
}

function handleProductSubmit(e) {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('productName').value,
        category: document.getElementById('productCategory').value,
        price: parseFloat(document.getElementById('productPrice').value),
        stock: parseInt(document.getElementById('productStock').value),
        sold: document.getElementById('productSold').checked,
        image: document.getElementById('previewImg').src
    };
    
    if (!formData.category) {
        showAlert('请选择商品分类');
        return;
    }
    
    if (editingProductId) {
        // 编辑现有商品
        const productIndex = products.findIndex(p => p.id === editingProductId);
        if (productIndex !== -1) {
            products[productIndex] = { ...products[productIndex], ...formData };
        }
    } else {
        // 添加新商品
        const newProduct = {
            id: Date.now(),
            ...formData,
            createdBy: currentUser.username
        };
        products.push(newProduct);
    }
    
    closeProductModal();
    loadProducts();
}

function editProduct(id) {
    if (currentUser.role !== 'admin') {
        showAlert('只有管理员才能编辑商品');
        return;
    }
    
    const product = products.find(p => p.id === id);
    if (product) {
        openProductModal(product);
    }
}

function deleteProduct(id) {
    if (currentUser.role !== 'admin') {
        showAlert('只有管理员才能删除商品');
        return;
    }
    
    showConfirmDialog('确定要删除这个商品吗？', () => {
        products = products.filter(p => p.id !== id);
        loadProducts();
    });
}

function handleImagePreview(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('imagePreview').classList.remove('hidden');
            document.getElementById('previewImg').src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
}

function handleAddCategory() {
    const categoryName = prompt('请输入新分类名称：');
    if (categoryName && !categories.includes(categoryName)) {
        categories.push(categoryName);
        updateCategoryOptions();
    }
}

function updateCategoryOptions() {
    const categorySelect = document.getElementById('productCategory');
    const categoryFilter = document.getElementById('categoryFilter');
    
    const categoryOptions = categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
    
    categorySelect.innerHTML = '<option value="">选择分类</option>' + categoryOptions;
    categoryFilter.innerHTML = '<option value="">所有分类</option>' + categoryOptions;
}

function filterProducts() {
    renderProducts();
}

// 用户管理功能
function openUserModal() {
    if (currentUser.role !== 'admin') {
        showAlert('只有管理员才能管理用户');
        return;
    }
    
    document.getElementById('userModal').classList.remove('hidden');
    renderUserList();
}

function closeUserModal() {
    document.getElementById('userModal').classList.add('hidden');
}

function handleAddUser(e) {
    e.preventDefault();
    
    const username = document.getElementById('newUsername').value;
    const password = document.getElementById('newPassword').value;
    const role = document.getElementById('newUserRole').value;
    
    if (users.find(u => u.username === username)) {
        showAlert('用户名已存在');
        return;
    }
    
    const newUser = {
        id: Date.now(),
        username,
        password,
        role,
        active: true
    };
    
    users.push(newUser);
    renderUserList();
    document.getElementById('addUserForm').reset();
}

function renderUserList() {
    const userList = document.getElementById('userList');
    
    userList.innerHTML = users.map(user => `
        <div class="flex items-center justify-between p-4 bg-white dark:bg-gray-700 rounded-xl">
            <div class="flex items-center space-x-4">
                <div class="w-10 h-10 bg-gradient-tech rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-white"></i>
                </div>
                <div>
                    <p class="font-medium text-gray-800 dark:text-white">${user.username}</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">${user.role === 'admin' ? '管理员' : '员工'}</p>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <span class="px-3 py-1 rounded-lg text-sm ${user.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                    ${user.active ? '活跃' : '禁用'}
                </span>
                ${user.username !== 'admin' ? `
                <button onclick="toggleUserStatus(${user.id})" class="px-3 py-1 ${user.active ? 'bg-red-500 hover:bg-red-600' : 'bg-green-500 hover:bg-green-600'} text-white rounded-lg transition-all duration-300">
                    ${user.active ? '禁用' : '启用'}
                </button>
                <button onclick="deleteUser(${user.id})" class="px-3 py-1 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-all duration-300">
                    删除
                </button>
                ` : ''}
            </div>
        </div>
    `).join('');
}

function toggleUserStatus(id) {
    const user = users.find(u => u.id === id);
    if (user) {
        user.active = !user.active;
        renderUserList();
        
        // 如果禁用的是当前登录用户，强制登出
        if (!user.active && currentUser.id === id) {
            showAlert('您的账户已被禁用，将自动登出');
            setTimeout(handleLogout, 2000);
        }
    }
}

function deleteUser(id) {
    showConfirmDialog('确定要删除这个用户吗？', () => {
        users = users.filter(u => u.id !== id);
        renderUserList();
    });
}

// 通用提示函数
function showAlert(message) {
    // 创建自定义提示框
    const alertDiv = document.createElement('div');
    alertDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-4 rounded-xl shadow-lg z-50 transform translate-x-full transition-transform duration-300';
    alertDiv.innerHTML = `
        <div class="flex items-center">
            <i class="fas fa-exclamation-triangle mr-3"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(alertDiv);
    
    // 显示动画
    setTimeout(() => {
        alertDiv.classList.remove('translate-x-full');
    }, 100);
    
    // 自动隐藏
    setTimeout(() => {
        alertDiv.classList.add('translate-x-full');
        setTimeout(() => {
            document.body.removeChild(alertDiv);
        }, 300);
    }, 3000);
}
</script>



</body></html>